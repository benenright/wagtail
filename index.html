<!DOCTYPE html>
<html lang="en">

<template id="item-actions-template">
    <div class="item-actions">
        <div class="line"></div>
        <div class="other-actions">
            <i class="far fa-copy copy" onclick="copyItem(this)"><span>Copy</span></i>
            <!-- <i class="far fa-clone clone"><span>↓ Duplicate</span></i> -->
            <i class="far fa-trash-can delete"><span>Delete</span></i>
        </div>
        <div class="reorder">
            <i class="fas fa-angle-up"></i>
            <i class="fas fa-angle-down"></i>
            <i class="fas fa-grip drag-handle"></i>
        </div>
    </div>
</template>

<template id="insert-paste-actions-template">
    <div class="insert-paste-actions">
        <i class="fas fa-plus-circle plus-icon" onclick="insertNewItem(this)"></i>
        <i class="far fa-paste paste-icon" onclick="pasteItem(this)"><span>↓</span><span class="word">Paste block</span></i>
    </div>
</template>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamField Drag n Drop n Copy n Paste</title>
    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>

        /* Body Styling */

        body {
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,Roboto,"Helvetica Neue",Arial,sans-serif,Apple Color Emoji,"Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            margin: 0;
            background-color: white;
            font-size: 14px;
            box-sizing: border-box;
            border-left: 60px solid #2E1F5E;
        }

        ul {
            list-style-type: none;
            width: 800px;
            margin: 0 0 0 80px;
            padding: 60px 0 60px 25px;
            display: block;
            border-left: 1px dashed #E0E0E0;
        }

        /* Block Styling */

        li {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            padding: 0px;
            cursor: move;
            transition: none; /* Disable transition animations */
            position: relative;
        }
        .item-expanded:hover .item-content {
            border: none;
        }
        li.dragging {
            opacity: 0.5;
            position: relative;
            pointer-events: none;
            z-index: 1000;
            width: 100%;
        }
        li.dragging .item-expanded:hover .item-content {
            border: 1px dashed transparent;
        }
        .placeholder {
            height: 60px; /* Adjust based on your item height */
            border: 2px dashed #6200ee;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .insert-paste-actions {
            display: flex;
            align-items: center;
            position: relative;
            left: 0;
            display: block;
            width: 100%;
            padding: 18px 11px;
            box-sizing: border-box;
        }
        .insert-paste-actions .plus-icon,
        .insert-paste-actions .paste-icon {
            color: white;
            border-radius: 50%;
            margin-right: 15px;
            font-size: 19px;
            line-height: 20px;
            width: 20px;
            height: 20px;
            text-align: center;
            float: left;
            cursor: pointer;
            border: 1px solid #008080;
            background-color: #008080;
        }
        .insert-paste-actions .plus-icon:hover {
            background-color: white;
            color: #008080;
        }
        .insert-paste-actions .paste-icon {
            width: auto;
            background-color: white;
            font-size: 17px;
            border: none;
            text-decoration: none;
            padding-top: 2px;
/*            padding-left: 15px;
            border-left: 1px solid #C8C8C8;*/
            border-radius: 0;
            color: #757575;
            .word {
                display: none;
            }
            span {
                font-size: 12px;
                font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,Roboto,"Helvetica Neue",Arial,sans-serif,Apple Color Emoji,"Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
                margin-left: 3px;
                margin-bottom: 5px;
                display: inline-block;
                font-weight: normal;
            }
            &:hover {
                color: black;
                span {
                    color: black;
                }
                .word {
                    display: inline-block;
                }
            }
        }

        .insert-paste-actions:hover .paste-icon {
            display: block;
        }

        .insert-paste-actions:focus .paste-icon {
            display: block;
        }

        .insert-paste-actions .paste-icon  span {
            color: #757575;
            text-decoration: none;
        }
        .item-content {
            box-sizing: border-box;
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: space-between;
            background-color: #f5f5f5;
            border-radius: 5px;
            padding: 12px 0px 12px 12px;
            border: 1px solid transparent;
        }
        .item-content:hover {
            border: 1px dashed #2E1F5E;
        }
        .item-content:active {
            border: 1px dashed transparent;
        }
        .item-left {
            display: flex;
            align-items: center;
        }
        .item-icon {
            font-size: 20px;
            margin-right: 15px;
            color: #6200ee;
            width: 20px;
            text-align: center;
        }
        .item-title {
            font-weight: bold;
            color: #3D00FF;
            margin-right: 10px;
            cursor: pointer;
        }
        .item-preview {
            color: #757575;
        }
        .item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .item-actions .line {
            display: none;
        }
        .item-expanded .item-actions .line {
            width: 380px;
            border-top: 1px dashed #E0E0E0;
            margin-right: 20px;
            display: inline-block;
        }
        .item-expanded:hover .line {
            border-top: 1px dashed #555;
        }
        .item-expanded:hover .vert-dotted-line {
            border-left: 1px dashed #555;
        }
        .item-actions i {
            font-size: 16px;
            color: #757575;
            cursor: pointer;
            span {
                font-size: 12px;
                font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,Roboto,"Helvetica Neue",Arial,sans-serif,Apple Color Emoji,"Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
                margin-left: 3px;
                margin-bottom: 5px;
                display: none;
                font-weight: normal;
            }
        }
        .item-actions i.fa-angle-up, .item-actions i.fa-angle-down  {
            font-size: 12px;
        }
        .item-actions i:hover {
            color: #000;
        }
        .other-actions {
            border-right: 1px solid #C8C8C8;
            padding-right: 10px;
            i {
                margin-right: 10px;
            }
        }
        .reorder {
            padding-left: 10px;
            i {
                margin-right: 10px;
            }
            .fa-grip {
                transform: rotate(90deg);
                font-size: 12px;
                cursor: move;
            }
        }
        .item-details {
            display: none;
            flex-direction: column;
            width: 100%;
            background-color: white;
            position: relative;
        }
        .item-details .vert-dotted-line {
            width: 1px;
            height: 100%;
            border-left: 1px dashed #E0E0E0;
            margin-right: 20px;
            display: inline-block;
            position: absolute;
            top:0;
            left: 20px;
        }
        .item-details input, .item-details textarea {
            margin-bottom: 10px;
            padding: 12px;
            border: 1px solid #C8C8C8;
            border-radius: 4px;
            width: 98%;
            font-size: 18px;
            box-sizing: border-box;
        }
        .item-details textarea {
            padding: 20px;
            font-size: 20px;
            line-height: 1.5;
            width: 98%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, Roboto, "Helvetica Neue", Arial, sans-serif, Apple Color Emoji, "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        .item-details label {
            color: #2E1F5E;
            padding: 8px 0;
        }
        .item-expanded .item-content {
            box-sizing: border-box;
            border-left: 1px dashed transparent;
            border-right: 1px dashed transparent;
            border-top: 1px dashed transparent;
            border-bottom: 1px dashed transparent;
            border-radius: 0;
            background-color: white;
        }

        .item-expanded:hover .item-content {
            border-left: 1px dashed transparent;
            border-right: 1px dashed transparent;
            border-top: 1px dashed transparent;
            border-bottom: 1px dashed transparent;
        }
/*        .item-expanded:active .item-details {
            border-left: 1px dashed transparent;
        }
        .item-expanded:active .item-content {
            border-left: 1px dashed transparent;
        }*/
        .item-expanded .item-details {
            display: flex;
            box-sizing: border-box;
            padding: 0px 0 0px 48px;
            width: 100%;
        }
        .item-expanded .item-preview {
            display: none;
        }
        .fa-check {
            color: #1D7792 !important;
        }


        /* Popup(s) Styling */
        
        #block-chooser-popup {
            display: none;
            position: absolute;
            background: white;
            padding: 20px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            z-index: 1000;
            width: 400px; /* Updated width to accommodate two columns */
        }

        #block-search {
            width: 94%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        #block-options-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two columns */
            gap: 10px; /* Space between items */
        }

        .block-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px dashed #E0E0E0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .paste-block-btn {
            box-sizing: border-box;
/*            border-top: 1px solid #E0E0E0;*/
            display: block;
            width: 100%;
            padding: 15px 10px;
            display: flex;
            margin: 5px 0 0 0;
            cursor: pointer;
            color: #333;
            .block-icon {
                color: grey;
                font-size: 20px;
            }
            .title {
                font-weight: 500;
            }
            .desc {
                color: #757575;
                padding: 5px 0;
                font-size: 12px;
            }
            &:hover {
                i {
                    color: black;
                }
            }
        }

        .block-option:hover {
            background-color: #f0f0f0;
            border: 1px dashed #2E1F5E;
        }

        .block-icon {
            font-size: 18px;
            margin-right: 10px;
            color: #6200ee;
            width: 20px;
            text-align: center;
        }

        .block-option span {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }


        #copy-popup {
            display: none;
            position: absolute;
            background: white;
            padding: 12px 12px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            z-index: 1001;
            i {
                box-sizing: border-box;
                cursor: pointer;
                padding: 4px 10px 2px 10px;
                color: #007D7E;
                font-size: 16px;
                border-radius: 3px;
                border: 1px solid transparent;
                &:hover {
                    color: #005B5E;
                    border: 1px solid #005B5E;
                    background-color: #F2FCFC;
                }
            }
            i span {
                font-size: 13px;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, Roboto, "Helvetica Neue", Arial, sans-serif, Apple Color Emoji, "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
                margin-left: 5px;
                margin-bottom: 5px;
                display: inline-block;
                font-weight: 500;
            }
        }

        #copy-popup button {
            background-color: #6200ee;
            color: white;
            border: none;
            padding: 10px 15px;
            margin-right: 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
        }

        #copy-popup button:hover {
            background-color: #5300d1;
        }

        .fa-check-green {
            color: green !important;
        }

        .dragging-shrink {
            height: 50px; /* Contracted height while dragging */
            background-color: #f0f0f0; /* Optional style to distinguish */
            overflow: hidden;
            width: 800px;
            border-radius: 5px;
        }

        .dragging-shrink .item-details, .dragging-shrink .item-actions  {
            display: none; /* Hide the expanded details while dragging */
        }

        .dragging-shrink .item-preview  {
            display: block; 
        }

        .dragging-shrink .item-content {
            padding: 15px;
            background-color: #fafafa; /* Optional background change */
            border-radius: 5px;
        }

        .nested {
            width: 100%;
            margin: 30px 0;
        }

        #jump-menu {
            position: fixed;
            top: 0;
            right: 0;
            width: 240px;
            padding: 40px 20px 20px 20px;
            border-left: 1px solid #ddd;
            z-index: 1000;
            height: 100vh;
        }

        #jump-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #jump-menu li {
            padding: 8px 10px;
            margin-bottom: 5px;
            background-color: #f5f5f5;
            border-radius: 5px;
            cursor: pointer;
            border: 1px dashed transparent;
            &:hover {
                border: 1px dashed #2E1F5E;
            }
        }

        #jump-menu li a {
            text-decoration: none;
            color: #000;
        }

        #jump-menu li.dragging {
            opacity: 0.5;
        }

        .jump-placeholder {
            height: 40px;
            background-color: #ddd;
            border: 2px dashed #999;
            margin-bottom: 5px;
        }

        .template-container-paste {
            height: 57px;
        }

        #toggle-all {
            position: sticky;
            top: 20px;
            right: 300px;
            float: right;
            padding: 5px 10px;
            background-color: white;
            border: 1px solid #008080;
            color: #008080;
            border-radius: 3px;
            cursor: pointer;
            z-index: 1000;
        }

        #toggle-all:hover {
            background-color: white;
            border: 1px solid #008080;
        }

        .fa-exclamation-triangle {
            color: red;
        }

    </style>
</head>

<body>

<button id="toggle-all" onclick="toggleAllItems()">Contract all</button>

<ul id="draggable-list">

    <li draggable="true" class="draggable-item">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-image item-icon"></i>
                <span class="item-title">Image Block</span>
                <span class="item-preview">Preview text for image block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item item-expanded">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-align-left item-icon"></i>
                <span class="item-title">Rich Text Block</span>
                <span class="item-preview">Preview text for rich text block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <textarea rows="8" cols="1">Wagtails are small, slender birds known for their distinctive habit of constantly wagging their long tails up and down. These birds are part of the Motacillidae family, and they are often seen walking or running along the ground, where they forage for insects. Wagtails are found across Europe, Asia, and Africa, and they are commonly associated with habitats near water, such as riverbanks, lakesides, and wetlands. Their plumage is often a mix of white, black, and gray, though some species also have yellow feathers.
            </textarea>
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item item-expanded">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-quote-right item-icon"></i>
                <span class="item-title">Quote Block</span>
                <span class="item-preview">Preview text for quote block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-chart-bar item-icon"></i>
                <span class="item-title">Chart Block</span>
                <span class="item-preview">Preview text for chart block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-video item-icon"></i>
                <span class="item-title">Video Block</span>
                <span class="item-preview">Preview text for video block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item item-expanded">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-images item-icon"></i>
                <span class="item-title">Gallery Block</span>
                <span class="item-preview">Preview text for gallery block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
            <div draggable="true" class="draggable-item nested">
                <div class="item-content">
                    <div class="item-left">
                        <i class="fas fa-images item-icon"></i>
                        <span class="item-title">Nested block</span>
                        <span class="item-preview">Preview text for gallery block</span>
                    </div>
                    <div class="template-container-item-actions"></div>
                </div>
                <div class="item-details">
                    <div class="vert-dotted-line"></div>
                    <label>Field label</label>
                    <input type="text" placeholder="Field 1">
                    <label>Field label</label>
                    <input type="text" placeholder="Field 2">
                    <label>Field label</label>
                    <input type="text" placeholder="Field 3">
                </div>
                <div class="template-container-paste"></div>
            </div>
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-calendar-alt item-icon"></i>
                <span class="item-title">Calendar Block</span>
                <span class="item-preview">Preview text for calendar block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-file-alt item-icon"></i>
                <span class="item-title">Document Block</span>
                <span class="item-preview">Preview text for document block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-link item-icon"></i>
                <span class="item-title">Link Block</span>
                <span class="item-preview">Preview text for link block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
    
    <li draggable="true" class="draggable-item">
        <div class="item-content">
            <div class="item-left">
                <i class="fas fa-code item-icon"></i>
                <span class="item-title">Custom Code Block</span>
                <span class="item-preview">Preview text for custom code block</span>
            </div>
            <div class="template-container-item-actions"></div>
        </div>
        <div class="item-details">
            <div class="vert-dotted-line"></div>
            <label>Field label</label>
            <input type="text" placeholder="Field 1">
            <label>Field label</label>
            <input type="text" placeholder="Field 2">
            <label>Field label</label>
            <input type="text" placeholder="Field 3">
        </div>
        <div class="template-container-paste"></div>
    </li>
</ul>

<div id="toast-notification" style="position: fixed; bottom: 20px; left: 40%; background-color: #1D7792; color: white; padding: 10px 20px; border-radius: 5px; display: none; z-index: 1000;">Block copied to clipboard</div>

<!-- Popup Structure for Block Chooser -->
<div id="block-chooser-popup" style="display:none; position:absolute; background:white; padding:20px; ; border-radius:8px; z-index:1000;">
    <input type="text" id="block-search" placeholder="Search options..." onkeyup="filterBlocks()" style=" padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px;">



    <div id="block-options-container">
        <div class="block-option" onclick="insertNewBlock('Image Block')">
            <i class="fas fa-image block-icon"></i>
            <span>Image</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Rich Text Block')">
            <i class="fas fa-align-left block-icon"></i>
            <span>Rich text</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Quote Block')">
            <i class="fas fa-quote-right block-icon"></i>
            <span>Quote</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('CTA - large banner Block')">
            <i class="fas fa-ad block-icon"></i>
            <span>CTA - large banner</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Video Block')">
            <i class="fas fa-video block-icon"></i>
            <span>Video embed</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Gallery Block')">
            <i class="fas fa-images block-icon"></i>
            <span>Gallery</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Calendar Block')">
            <i class="fas fa-calendar-alt block-icon"></i>
            <span>Calendar</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Document Block')">
            <i class="fas fa-file-alt block-icon"></i>
            <span>Document</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Link Block')">
            <i class="fas fa-link block-icon"></i>
            <span>Link</span>
        </div>
        <div class="block-option" onclick="insertNewBlock('Custom Code Block')">
            <i class="fas fa-code block-icon"></i>
            <span>Custom Code</span>
        </div>
        <div class="paste-block-btn" onclick="pasteItemFromPopup()">
            <i class="far fa-paste block-icon"></i>
            <div class="paste-btn-text">
                <div class="title">Paste block</div>
                <div class="desc"></div>
            </div>
        </div>
        <div class="paste-block-btn">
            <i class="fas fa-scissors block-icon"></i>
            <div class="paste-btn-text">
                <div class="title">Split block</div>
            </div>
        </div>
    </div>

<!--     <div class="paste-block-btn" onclick="pasteItemFromPopup()">
        <i class="far fa-paste block-icon"></i>
        <div class="paste-btn-text">
            <div class="title">Paste block</div>
            <div class="desc">If you have a compatible block copied to the clipboard</div>
        </div>
    </div>

    <div class="paste-block-btn">
        <i class="fas fa-scissors block-icon"></i>
        <div class="paste-btn-text">
            <div class="title">Split block</div>
        </div>
    </div> -->

</div>

<script>

    function insertTemplate(templateId, targetElement) {
        const template = document.getElementById(templateId);
        const clone = template.content.cloneNode(true);
        targetElement.appendChild(clone);
    }


    document.querySelectorAll('.template-container-item-actions').forEach(container => {
        insertTemplate('item-actions-template', container);
    });


    document.querySelectorAll('.template-container-paste').forEach(container => {
        insertTemplate('insert-paste-actions-template', container);
    });


    let copiedItem = null;  // Variable to store the copied item

    const listItems = document.querySelectorAll('#draggable-list li');
    const list = document.getElementById('draggable-list');
    let draggingItem = null;
    let placeholder = document.createElement('div');
    placeholder.className = 'placeholder';

    listItems.forEach(item => {
        attachEventListeners(item);
    });

    function attachEventListeners(item) {
        const title = item.querySelector('.item-title');

        title.addEventListener('click', () => {
            item.classList.toggle('item-expanded');
        });

        item.addEventListener('dragstart', (e) => {
            // Manually create a clone of the item and apply the shrink class
            const dragClone = item.cloneNode(true);
            dragClone.classList.add('dragging-shrink');
            dragClone.style.position = 'absolute'; // Ensure it doesn't affect the layout
            dragClone.style.pointerEvents = 'none'; // Disable interactions with the clone
            
            document.body.appendChild(dragClone);  // Add the clone to the body (outside the list)

            // Set the drag image
            e.dataTransfer.setDragImage(dragClone, 0, 0);

            draggingItem = item;

            // Timeout to trigger the actual dragging
            setTimeout(() => {
                item.classList.add('dragging');
                list.insertBefore(placeholder, item.nextSibling);
            }, 0);

            // Clean up the clone after dragging starts
            setTimeout(() => document.body.removeChild(dragClone), 0);

            e.dataTransfer.setData('text/html', ''); // required for Firefox compatibility
        });

        item.addEventListener('dragend', () => {
            item.classList.remove('dragging');
            list.insertBefore(draggingItem, placeholder);
            placeholder.remove();
            draggingItem = null;
        });

        item.addEventListener('dragover', (e) => {
            e.preventDefault();
            const bounding = item.getBoundingClientRect();
            const offset = bounding.y + bounding.height / 2;
            const afterDraggingOverItem = e.clientY > offset;

            if (afterDraggingOverItem) {
                list.insertBefore(placeholder, item.nextSibling);
            } else {
                list.insertBefore(placeholder, item);
            }
        });

        item.addEventListener('drop', (e) => {
            e.stopPropagation();
            e.preventDefault();
            if (draggingItem !== item) {
                list.insertBefore(draggingItem, placeholder);
            }
        });
    }



    let activeInsertButton = null;  // Global variable to store the insert button

    function insertNewItem(insertButton) {
        const popup = document.getElementById('block-chooser-popup');

        // Position the popup near the clicked "+" button
        const rect = insertButton.getBoundingClientRect();
        popup.style.top = `${rect.bottom - 45 + window.scrollY}px`;
        popup.style.left = `${rect.left + 30 + window.scrollX}px`;
        popup.style.display = 'block';

        // Store the reference to the insert button for later use
        activeInsertButton = insertButton;  // Store the actual element, not a string
    }

    function insertNewBlock(blockType) {
        const popup = document.getElementById('block-chooser-popup');

        if (!activeInsertButton) {
            return;  // Return if there's no active insert button
        }

        const newItem = document.createElement('li');
        newItem.className = 'draggable-item item-expanded';
        newItem.draggable = true;

        // Insert the corresponding block content
        newItem.innerHTML = `

                <div class="item-content">
                    <div class="item-left">
                        <i class="fas ${getIconForBlock(blockType)} item-icon"></i>
                        <span class="item-title">${blockType}</span>
                        <span class="item-preview">Preview text for ${blockType.toLowerCase()}</span>
                    </div>
                    <div class="item-actions">
                        <div class="line"></div>
                        <div class="other-actions">
                            <i class="far fa-copy copy" onclick="copyItem(this)"><span>Copy</span></i>
                            <!-- <i class="far fa-clone clone"><span>↓ Duplicate</span></i> -->
                            <i class="far fa-trash-can delete"><span>Delete</span></i>
                        </div>
                        <div class="reorder">
                            <i class="fas fa-angle-up"></i>
                            <i class="fas fa-angle-down"></i>
                            <i class="fas fa-grip drag-handle"></i>
                        </div>
                    </div>
                </div>
                <div class="item-details">
                    <div class="vert-dotted-line"></div>
                    <label>Field label</label>
                    <input type="text" placeholder="Field 1">
                    <label>Field label</label>
                    <input type="text" placeholder="Field 2">
                    <label>Field label</label>
                    <input type="text" placeholder="Field 3">
                </div>
                <div class="insert-paste-actions">
                    <i class="fas fa-plus-circle plus-icon" onclick="insertNewItem(this)"></i>
                    <i class="far fa-paste paste-icon" onclick="pasteItem(this)"><span>↓</span></i>
                </div>

            `;

        // Insert the new block after the button that opened the popup
        activeInsertButton.closest('li').insertAdjacentElement('afterend', newItem);
        attachEventListeners(newItem);  // Attach event listeners for the new item (e.g., drag/drop)

        // Hide the popup
        popup.style.display = 'none';

        // Clear the activeInsertButton
        activeInsertButton = null;
    }

    function pasteItemFromPopup() {
        const pasteButton = document.querySelector('.paste-block-btn');  // The paste button in the popup
        const pasteIcon = pasteButton.querySelector('i');  // The icon inside the button
        const pasteText = pasteButton.querySelector('.paste-btn-text .title');  // The title text inside the button
        const pasteDesc = pasteButton.querySelector('.paste-btn-text .desc');  // The desc text inside the button

        if (copiedItem) {
            // If there is a copied item, paste it
            const newItem = copiedItem.cloneNode(true);
            activeInsertButton.closest('li').insertAdjacentElement('afterend', newItem);
            attachEventListeners(newItem);

            // Hide the popup
            document.getElementById('block-chooser-popup').style.display = 'none';
        } else {
            // If no copied item, display an alert and don't close the popup
            if (pasteIcon && pasteText && pasteDesc) {
                pasteIcon.classList.remove('fa-paste');
                pasteIcon.classList.add('fas', 'fa-exclamation-triangle');  // Use 'fas' for solid icons
                pasteText.textContent = 'No block to paste';
                pasteDesc.textContent = 'First copy a compatible block to the clipboard using the ‘copy’ button at the top the block.';

                // Revert to the original state after 3 seconds
                setTimeout(() => {
                    pasteIcon.classList.remove('fa-exclamation-triangle');
                    pasteIcon.classList.add('fas', 'fa-paste');
                    pasteText.textContent = 'Paste block';
                    pasteDesc.textContent = 'If you have a compatible block copied to the clipboard';
                }, 6000);
            }
        }
    }

    function getIconForBlock(blockType) {
        const icons = {
            'Image Block': 'fa-image',
            'Rich Text Block': 'fa-align-left',
            'Quote Block': 'fa-quote-right',
            'CTA - large banner Block': 'fa-ad',
            'Video Block': 'fa-video',
            'Gallery Block': 'fa-images',
            'Calendar Block': 'fa-calendar-alt',
            'Document Block': 'fa-file-alt',
            'Link Block': 'fa-link',
            'Custom Code Block': 'fa-code',
        };
        return icons[blockType] || 'fa-question-circle'; // Default icon if block type not found
    }

    // Function to show the toast notification
        function showToast(message) {
            const toast = document.getElementById('toast-notification');
            toast.textContent = message;
            toast.style.display = 'block';

            // Hide after 3 seconds
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

    function copyItem(copyButton) {
            // Get the item to be copied
            const itemToCopy = copyButton.closest('li');
            copiedItem = itemToCopy.cloneNode(true);

            // Get the icon element (which is the copyButton itself)
            const icon = copyButton;
            const textSpan = icon.querySelector('span');

            // Change the icon class to 'fa-check'
            icon.classList.remove('fa-clone');
            icon.classList.remove('far');
            icon.classList.add('fa-check');
            icon.classList.add('fas');
            textSpan.textContent = 'Copied';

            // Trigger toast notification
            showToast('Block copied to clipboard');

            // Revert to the original icon after 2 seconds
            setTimeout(() => {
                icon.classList.remove('fa-check');
                icon.classList.remove('fas');
                icon.classList.add('fa-check');
                icon.classList.add('far');
                textSpan.textContent = 'Copy';
            }, 2000);
        }

    function pasteItem(pasteButton) {
        const pasteIcon = pasteButton.querySelector('i');

        if (copiedItem) {
            // Paste the copied item as before
            const newItem = copiedItem.cloneNode(true);
            pasteButton.closest('li').insertAdjacentElement('afterend', newItem);
            attachEventListeners(newItem);
        } else {
            // If no block is copied, show the alert message and change the icon
            pasteIcon.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
            pasteButton.querySelector('span').textContent = 'No block to paste, copy a block using the "copy" button at the top';
            pasteButton.style.color = 'red';  // Change color to red for alert

            // Revert to original state after 3 seconds
            setTimeout(() => {
                pasteIcon.innerHTML = '<i class="far fa-paste"></i>';
                pasteButton.querySelector('span').textContent = 'Paste block';
                pasteButton.style.color = '';  // Reset color
            }, 3000);
        }
    }

    

    document.addEventListener('DOMContentLoaded', () => {
        const listItems = document.querySelectorAll('#draggable-list li');

        // Dynamically assign unique IDs to blocks if they don't already have an ID
        listItems.forEach((item, index) => {
            if (!item.id) {
                item.id = `block-${index + 1}`;
            }
        });

        // Function to generate the jump menu dynamically
        function generateJumpMenu() {
            const jumpMenu = document.createElement('ul');
            jumpMenu.id = 'jump-menu';
            document.body.appendChild(jumpMenu);

            listItems.forEach((item) => {
                addMenuItemForBlock(item);
            });
        }

        // Function to add a block to the jump menu
        function addMenuItemForBlock(block) {
            const jumpMenu = document.getElementById('jump-menu');
            const menuItem = document.createElement('li');
            menuItem.innerHTML = `<span>${block.querySelector('.item-title').textContent}</span>`;
            menuItem.setAttribute('data-block-id', block.id);
            menuItem.setAttribute('draggable', true);

            // Make the jump menu items draggable
            menuItem.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', menuItem.getAttribute('data-block-id'));
                e.dataTransfer.effectAllowed = 'move';
            });

            menuItem.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            menuItem.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggedId = e.dataTransfer.getData('text/plain');
                const draggedMenuItem = document.querySelector(`[data-block-id="${draggedId}"]`);
                const targetMenuItem = e.currentTarget;

                // Reorder the items in the jump menu
                const jumpMenu = targetMenuItem.parentElement;
                jumpMenu.insertBefore(draggedMenuItem, targetMenuItem);

                // Update the order of blocks in the main list
                reorderBlocksBasedOnJumpMenu();
            });

            // Add click event to scroll to the corresponding block in the main list
            menuItem.addEventListener('click', () => {
                const targetBlock = document.getElementById(menuItem.getAttribute('data-block-id'));
                if (targetBlock) {
                    targetBlock.scrollIntoView({
                        behavior: 'smooth', // Smooth scroll effect
                        block: 'start', // Align to the top of the block
                    });
                }
            });

            jumpMenu.appendChild(menuItem);
        }

        // Function to reorder blocks in the main list based on the jump menu
        function reorderBlocksBasedOnJumpMenu() {
            const reorderedMenuItems = document.querySelectorAll('#jump-menu li');
            const list = document.getElementById('draggable-list');

            reorderedMenuItems.forEach(menuItem => {
                const blockId = menuItem.getAttribute('data-block-id');
                const block = document.getElementById(blockId);
                if (block) {
                    list.appendChild(block); // Move block to the new position in the main list
                }
            });
        }

        // Function to update jump menu when blocks are reordered in the main list
        function updateJumpMenuAfterReorder() {
            const jumpMenu = document.getElementById('jump-menu');
            jumpMenu.innerHTML = ''; // Clear existing menu
            document.querySelectorAll('#draggable-list li').forEach((item) => {
                addMenuItemForBlock(item); // Rebuild the menu with current block order
            });
        }

        // Reattach event listeners after drag ends in the main list
        function attachDragEventsToMainList() {
            const listItems = document.querySelectorAll('#draggable-list li');
            listItems.forEach((item) => {
                item.addEventListener('dragend', () => {
                    updateJumpMenuAfterReorder(); // Update jump menu after drag ends
                });
            });
        }

        // Function to handle new block insertion (e.g., paste or insert)
        function insertNewBlock(blockType) {
            const newItem = document.createElement('li');
            newItem.className = 'draggable-item item-expanded';
            newItem.draggable = true;
            newItem.id = `block-${document.querySelectorAll('#draggable-list li').length + 1}`; // Unique ID

            // Insert the corresponding block content
            newItem.innerHTML = `
                <div class="item-content">
                    <div class="item-left">
                        <i class="fas ${getIconForBlock(blockType)} item-icon"></i>
                        <span class="item-title">${blockType}</span>
                        <span class="item-preview">Preview text for ${blockType.toLowerCase()}</span>
                    </div>
                    <div class="template-container-item-actions"></div>
                </div>
                <div class="item-details">
                    <div class="vert-dotted-line"></div>
                    <label>Field label</label>
                    <input type="text" placeholder="Field 1">
                    <label>Field label</label>
                    <input type="text" placeholder="Field 2">
                    <label>Field label</label>
                    <input type="text" placeholder="Field 3">
                </div>
                <div class="template-container-paste"></div>
            `;

            const list = document.getElementById('draggable-list');
            list.appendChild(newItem);

            // Attach event listeners to new item
            attachEventListeners(newItem);
            addMenuItemForBlock(newItem); // Add to jump menu
        }

        // Call the function to generate the jump menu
        generateJumpMenu();

        // Attach event listeners to main list items for drag/drop updates
        attachDragEventsToMainList();
    });


    function toggleAllItems() {
        const toggleButton = document.getElementById('toggle-all');
        const allItems = document.querySelectorAll('#draggable-list li');

        if (toggleButton.textContent === 'Contract all') {
            allItems.forEach(item => item.classList.remove('item-expanded'));
            toggleButton.textContent = 'Expand all';
        } else {
            allItems.forEach(item => item.classList.add('item-expanded'));
            toggleButton.textContent = 'Contract all';
        }
    }


</script>

</body>
</html>
